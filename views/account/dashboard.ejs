<div class="page-header">
    <h1>Dashboard Overview</h1>
    <p class="text-body-secondary">Welcome back, <%= user.firstName %>. Here's a snapshot of your store's activity.</p>
</div>

<div class="row g-4">
    <div class="col-md-6 col-xl-3">
        <div class="dashboard-card stat-card h-100">
            <div class="card-body">
                <div class="stat-details">
                    <p class="stat-title mb-1">Total Revenue</p>
                    <p class="stat-value mb-0"><%= data.totalRevenue.toLocaleString('en-US', { style: 'currency', currency: 'USD' }) %></p>
                    <small class="text-muted mt-2 d-block">All-time sales data</small>
                </div>
                <div class="stat-icon stat-icon-revenue">
                    <i class="bi bi-currency-dollar"></i>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-6 col-xl-3">
        <div class="dashboard-card stat-card h-100">
            <div class="card-body">
                <div class="stat-details">
                    <p class="stat-title mb-1">Total Orders</p>
                    <p class="stat-value mb-0"><%= data.orderCount %></p>
                    <small class="text-muted mt-2 d-block">Completed & processing</small>
                </div>
                <div class="stat-icon stat-icon-orders">
                    <i class="bi bi-receipt"></i>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-6 col-xl-3">
        <div class="dashboard-card stat-card h-100">
            <div class="card-body">
                <div class="stat-details">
                    <p class="stat-title mb-1">Total Users</p>
                    <p class="stat-value mb-0"><%= data.userCount %></p>
                    <small class="text-muted mt-2 d-block">Registered accounts</small>
                </div>
                <div class="stat-icon stat-icon-users">
                    <i class="bi bi-people-fill"></i>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-6 col-xl-3">
        <div class="dashboard-card stat-card h-100">
            <div class="card-body">
                <div class="stat-details">
                    <p class="stat-title mb-1">Products</p>
                    <p class="stat-value mb-0"><%= data.productCount %></p>
                    <small class="text-muted mt-2 d-block">In your local inventory</small>
                </div>
                <div class="stat-icon stat-icon-products">
                    <i class="bi bi-box-seam-fill"></i>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="dashboard-card mt-4">
    <div class="card-body">
        <h5 class="card-title mb-4 fw-semibold">Recent Activity</h5>
        
        <%# UPDATED: Logic to display the new combined activity feed %>
        <% if (data.recentActivity && data.recentActivity.length > 0) { %>
            <ul class="list-group list-group-flush">
                <% data.recentActivity.forEach(activity => { %>
                    <li class="list-group-item d-flex justify-content-between align-items-center px-0">
                        <div>
                            <% if (activity.type === 'ORDER') { %>
                                <i class="bi bi-receipt text-info me-2"></i>
                                New order #...<%= activity.data._id.toString().slice(-4) %> placed by <%= activity.data.customer.firstName %> for <strong><%= activity.data.total.toLocaleString('en-US', { style: 'currency', currency: 'USD' }) %></strong>
                            <% } else if (activity.type === 'IMPORT') { %>
                                <i class="bi bi-box-arrow-in-down text-success me-2"></i>
                                Admin <strong><%= activity.data.userFirstName %></strong> imported <strong><%= activity.data.details.productCount %></strong> new products.
                            <% } %>
                        </div>
                        <small class="text-body-secondary"><%= new Date(activity.timestamp).toLocaleDateString() %></small>
                    </li>
                <% }) %>
            </ul>
        <% } else { %>
            <p class="text-body-secondary text-center p-4">No recent activity to show.</p>
        <% } %>
    </div>
</div>