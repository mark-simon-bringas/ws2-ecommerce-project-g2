<style>
    /* Scoped styles for the gateway card to fit within the main layout */
    .gateway-wrapper {
        min-height: 80vh; /* Ensures it takes up mostly full screen height within the layout */
    }
    .gateway-card { 
        width: 100%; 
        max-width: 400px; 
        border-radius: 16px; 
        overflow: hidden;
        box-shadow: 0 10px 30px rgba(0,0,0,0.1); 
        border: none; 
    }
    .loader { 
        display: none;
        position: absolute; 
        top: 0; 
        left: 0; 
        width: 100%; 
        height: 100%; 
        background: rgba(255,255,255,0.95); 
        z-index: 10; 
        flex-direction: column; 
        align-items: center; 
        justify-content: center;
    }
</style>

<div class="container d-flex align-items-center justify-content-center gateway-wrapper py-5">
    <div class="gateway-card bg-white position-relative">
        
        <div class="p-4 text-center text-white" style="background-color: <%= theme.headerBg %>">
            <i class="bi <%= theme.icon %> fs-1 mb-2"></i>
            <h4 class="fw-bold m-0"><%= providerName %></h4>
        </div>
        
        <div class="p-4">
            <div class="text-center mb-4">
                <small class="text-secondary fw-bold letter-spacing-1">TOTAL AMOUNT</small>
                <h2 class="fw-bold mt-1" style="color: <%= theme.headerBg %>">
                    <%= currency %> <%= amount.toLocaleString(undefined, {minimumFractionDigits: 2}) %>
                </h2>
            </div>
            
            <form action="/checkout/confirm-payment/<%= orderId %>" method="POST" id="payForm">
                <div class="form-floating mb-3">
                    <input type="text" class="form-control" required placeholder="Account" autocomplete="off">
                    <label>Mobile Number / Email</label>
                </div>
                <div class="form-floating mb-4">
                    <input type="password" class="form-control" required placeholder="PIN" autocomplete="new-password">
                    <label>MPIN / Password</label>
                </div>
                <button class="btn w-100 py-3 fw-bold shadow-sm" style="background: <%= theme.btnBg %>; color: <%= theme.btnText %>">
                    PAY NOW
                </button>
            </form>
            
            <div class="text-center mt-3">
                <a href="/checkout" class="text-decoration-none small text-secondary">Cancel Transaction</a>
            </div>
        </div>

        <div class="loader" id="loader">
            <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;"></div>
            <h5 class="mt-3 fw-bold text-dark">Processing Payment...</h5>
            <p class="small text-secondary">Please do not close this window.</p>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.getElementById('payForm');
        const loader = document.getElementById('loader');

        form.addEventListener('submit', function(e) {
            e.preventDefault();
            // Show loader
            loader.style.display = 'flex';
            
            // Simulate gateway processing delay before actual submission
            setTimeout(() => {
                this.submit();
            }, 2000);
        });
    });
</script>